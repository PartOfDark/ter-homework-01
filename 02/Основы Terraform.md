# Домашнее задание к занятию "Основы Terraform. Yandex cloud"

### Цель задания

1. Создать свои первые ресурсы в облаке Yandex cloud с помощью terraform.
2. Освоить работу с переменными terraform

------

### Чеклист готовности к домашнему заданию

1. Зарегистрирован аккаунт в Yandex Cloud. Использован промокод на грант.
2. установлен инструмент yandex cli

------

### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

1. ...
2. ...

### Задание 1

1. Изучите проект. В файле variables.tf уже объявлены переменные для yandex provider.
2. Переименуйте файл personal.auto.tfvars_example в personal.auto.tfvars. Заполните переменные(идентификаторы облака, токен доступа). Благодаря .gitignore этот файл не попадет в публичный репозиторий.
3. Сгенерируйте или используйте свой текущий ssh ключ. Запишите его открытую часть в переменную **vms_ssh_root_key**.
3. Инициализируйте проект, выполните код. Исправьте возникшую ошибку, в чем ее суть?

Приложите скриншот ЛК Yandex cloud с созданной ВМ и скриншот успешного подключения к консоли ВМ через ssh.
Что означает ```preemptible = true``` в параметрах ВМ? Ответ найдите в документации yandex cloud.

------

### Задание 2

1. Изучите файлы проекта .
2. Замените все "хардкод" **значения** для ресурсов **yandex_compute_image** и **yandex_compute_instance** на **отдельные** переменные. К названиям переменных ВМ добавьте в начало префикс **vm_web_** .  Пример: **vm_web_name**
2. Объявите нужные переменные в файле variables.tf, обязательно указывайте тип переменной. Заполните их **default** прежними значениями из main.tf. 
3. Проверьте terraform plan, изменений быть не должно. 

------

### Задание 3
1. Создайте в корне проекта файл 'vms_platform.tf' . Перенесите в него все переменные ВМ.
2. Скопируйте блок ресурса и создайте с его помощью вторую ВМ: **"netology-develop-platform-db"** ,  cores  = 2, memory = 2, core_fraction = 20. Объявите ее переменные с префиксом **vm_db_** в том же файле.
3. Примените изменения

------

### Задание 4
1. Объявите в файле outputs.tf отдельные output , для каждой из ВМ с ее внешним IP адресом.
2. Примените изменения

В качестве ответа приложите скриншот вывода значений ip-адресов команды ```terraform output```

------
### Задание 5
1. В файле locals.tf опишите в **одном** local-блоке имя каждой ВМ, используйте интерполяцию по примеру из лекции.
2. Замените переменные с именами ВМ из файла variables.tf на созданные вами local переменные.
3. Примените изменения


------
### Задание 6
1. Вместо использования 3-х переменных  ".._cores",".._memory",".._core_fraction" в блоке resources {...}, объедените их в одну переменную типа **map** с именами "vm_web_resources" и "vm_db_resources".
2. Так же поступите с блоком **metadata {serial-port-enable, ssh-keys}**, эта переменная должна быть общая для обеих ВМ.
3. Найдите и удалите все, более не используемые переменные проекта.
4. Проверьте terraform plan, изменений быть не должно.

Для общего зачета создайте в github новый репозиторий. Создайте в нем новую ветку terraform-02, закомитьте в эту ветку свой финальный код проекта, пришлите ссылку на коммит. Удалите созданные ресурсы.


### Задание 7*(не обязательно)

Изучите сожержимое файла console.tf. Откройте terraform console, выполните следующие задания. Для зачета предоставье необходимые команды и их вывод.

1. Какой командой можно отобразить **второй** элемент списка test_list ?
2. Найдите длину списка test_list с помощью функции length(<имя переменной>)
3. Какой командой можно отобразить значение ключа admin из map test_map ?
4. Напишите interpolation выражение, результатом которого будет: "John is admin for production server based on ubuntu-20-04 with X vcpu, Y ram and Z virtual disks", используйте данные из переменных test_list, test_map, servers и функцию length() для подстановки значений.

В качестве ответа пришлите команду и вывод.

------
### Правила приема работы

1. Отправлена ссылка на репозиторий (github) с выполненным заданием

------